{% extends "cms/german_with_videos/base.html" %}

{% block content %}
<div class="container">
    <div class="level mb-6">
        <div class="level-left">
            <h1 class="title is-2">Review Videos</h1>
        </div>
        <div class="level-right">
            <div class="buttons">
                <form method="post" action="{% url 'cms:german_with_videos:reduce_review_priorities' %}" class="inline">
                    {% csrf_token %}
                    <button type="submit" class="button is-warning">
                        <span class="icon">
                            <i data-lucide="arrow-down"></i>
                        </span>
                        <span>Reduce Priorities</span>
                    </button>
                </form>
                <form method="post" action="{% url 'cms:german_with_videos:update_video_statuses' %}" class="inline">
                    {% csrf_token %}
                    <button type="submit" class="button is-primary">
                        Save All Changes
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Bulk Status Update -->
    {% if videos %}
    <div class="box mb-6">
        <h2 class="title is-4 mb-4">Bulk Status Update</h2>
        <form method="post" action="{% url 'cms:german_with_videos:update_video_statuses' %}" class="field is-grouped">
            {% csrf_token %}
            <div class="control">
                <div class="select">
                    <select name="bulk_status">
                        <option value="">Select an action...</option>
                        <option value="shortlisted">Shortlist All</option>
                        <option value="longlisted">Longlist All</option>
                        <option value="not_relevant">Set All to Not Relevant</option>
                    </select>
                </div>
            </div>
            <div class="control">
                <button type="submit" 
                        class="button is-primary"
                        onclick="return confirm('Are you sure you want to update the status of all videos?')">
                    Confirm Bulk Update
                </button>
            </div>
        </form>
    </div>
    {% endif %}
    
    {% if videos %}
        <form method="post" action="{% url 'cms:german_with_videos:update_video_statuses' %}">
            {% csrf_token %}
            
            <div class="columns is-multiline">
                {% for video in videos %}
                    <div class="column is-one-third">
                        <div class="card">
                            <div class="card-image">
                                <div class="video-container">
                                    <iframe 
                                        src="https://www.youtube.com/embed/{{ video.youtube_id }}"
                                        frameborder="0"
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                        allowfullscreen>
                                    </iframe>
                                </div>
                            </div>
                            
                            <div class="card-content">
                                {% if video.available_subtitle_languages %}
                                    <div class="mb-4">
                                        <p class="has-text-weight-medium mb-2">Available Subtitles:</p>
                                        <div class="tags">
                                            {% for lang in video.available_subtitle_languages %}
                                                <span class="tag">
                                                    {{ lang }}
                                                </span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                {% endif %}
                                
                                <div class="content">
                                    <div class="field">
                                        <label class="label">Status</label>
                                        <div class="control">
                                            <div class="field">
                                                <label class="radio">
                                                    <input type="radio" name="status_{{ video.youtube_id }}" value="needs_review" {% if video.status == 'needs_review' %}checked{% endif %}>
                                                    Needs Review
                                                </label>
                                            </div>
                                            <div class="field">
                                                <label class="radio">
                                                    <input type="radio" name="status_{{ video.youtube_id }}" value="shortlisted" {% if video.status == 'shortlisted' %}checked{% endif %}>
                                                    Shortlist
                                                </label>
                                            </div>
                                            <div class="field">
                                                <label class="radio">
                                                    <input type="radio" name="status_{{ video.youtube_id }}" value="longlisted" {% if video.status == 'longlisted' %}checked{% endif %}>
                                                    Longlist
                                                </label>
                                            </div>
                                            <div class="field">
                                                <label class="radio">
                                                    <input type="radio" name="status_{{ video.youtube_id }}" value="not_relevant" {% if video.status == 'not_relevant' %}checked{% endif %}>
                                                    Not Relevant
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="field">
                                        <label class="label">Comment</label>
                                        <div class="control">
                                            <textarea name="comment_{{ video.youtube_id }}" 
                                                      class="textarea"
                                                      rows="2"
                                                      placeholder="Add a comment...">{{ video.comment }}</textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>

            <div class="field is-grouped is-grouped-centered mt-6">
                <div class="control">
                    <button type="submit" class="button is-primary">
                        Save All Changes
                    </button>
                </div>
                <div class="control">
                    <a href="{% url 'cms:german_with_videos:review_videos' %}" 
                       class="button is-light">
                        Cancel
                    </a>
                </div>
            </div>
        </form>
    {% else %}
        <div class="has-text-centered py-6">
            <p class="has-text-grey">No videos need review at the moment.</p>
            <a href="{% url 'cms:german_with_videos:import_channel_videos' %}" class="has-text-link">
                Import more videos
            </a>
        </div>
    {% endif %}
</div>

<style>
.video-container {
    position: relative;
    padding-bottom: 56.25%;
    height: 0;
    overflow: hidden;
}

.video-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}
</style>
{% endblock %} 